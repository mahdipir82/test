{% extends "maintemplate.html" %}
{% load static %}
{% block content %}
<div class="container mx-auto px-4 py-6">
    <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Ù„Ù¾ØªØ§Ù¾ Ù‡Ø§</h2>

    <div id="laptopsList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
</div>

<script>
// ğŸŸ¦ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú¯Ø±ÙØªÙ† ÙÙ‚Ø· Ù„Ù¾ØªØ§Ù¾â€ŒÙ‡Ø§ Ø§Ø² API
async function fetchLaptops() {
    try {
        const response = await fetch("http://127.0.0.1:8000/products/products/");
        return await response.json();
    } catch (error) {
        console.error("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØµÙˆÙ„Ø§Øª:", error);
        return [];
    }
}

// ğŸŸ© ØªØ§Ø¨Ø¹ Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Øª Ù…Ø­ØµÙˆÙ„Ø§Øª (Ú©Ù¾ÛŒ Ù‡Ù…Ø§Ù† ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ)
function renderProductSection(elementId, productList) {
    const container = document.getElementById(elementId);
    if (!container) return;

    // Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØµÙˆØµ ÙÙ‚Ø· Ù„Ù¾ØªØ§Ù¾â€ŒÙ‡Ø§
    let cardClass = 'bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-blue-200 dark:border-blue-700/50';
    let priceColor = 'text-blue-600 dark:text-blue-400';
    let buttonClass = 'bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white';
    let hoverEffect = 'hover:shadow-xl hover:shadow-blue-500/30 hover:scale-105';

    container.innerHTML = productList.map(product => {
        const hasDiscount = product.discount && product.discount > 0;
        const isLowStock = product.stock_quantity && product.stock_quantity < 5;
        const isOutOfStock = !product.stock_quantity || product.stock_quantity <= 0;

        return `
        <div class="product-card ${cardClass} rounded-xl shadow-lg overflow-hidden border transition-all duration-300 ${hoverEffect}">
          <div class="relative">
            <img src="${product.main_image}" alt="${product.name}" class="w-full h-48 object-cover">
            
            ${hasDiscount ? '<span class="absolute top-3 left-3 bg-gradient-to-r from-red-500 to-pink-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡</span>' : ''}
            ${isLowStock ? '<span class="absolute top-3 left-3 bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…Ø­Ø¯ÙˆØ¯</span>' : ''}
            ${isOutOfStock ? '<span class="absolute top-3 left-3 bg-gray-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</span>' : ''}
          </div>

          <div class="p-5">
            <h4 class="font-bold mb-3 text-lg dark:text-white line-clamp-2">${product.name}</h4>

            <div class="flex items-center gap-2 mb-4">
              ${hasDiscount ? `<span class="text-gray-400 line-through text-sm">${product.originalPrice.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>` : ''}
              <span class="${priceColor} font-bold text-xl">${(hasDiscount ? product.finalPrice : product.originalPrice).toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
            </div>

            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${product.stock_quantity || 0} Ø¹Ø¯Ø¯</p>

            <div class="flex gap-2">
               <button type="button" onclick="viewProduct('${product.id}')" class="flex-1 text-center bg-white/70 dark:bg-gray-700/70 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-lg transition-all duration-300 text-sm font-medium backdrop-blur-sm ${isOutOfStock ? 'pointer-events-none opacity-60' : ''}" ${isOutOfStock ? 'disabled' : ''}>
                Ù…Ø´Ø§Ù‡Ø¯Ù‡
                </button>
              <button onclick="addToCart('${product.id}')" class="flex-1 ${buttonClass} px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 shadow-md hover:shadow-lg" ${isOutOfStock ? 'disabled opacity-50 cursor-not-allowed' : ''}>
                Ø§ÙØ²ÙˆØ¯Ù†
              </button>
            </div>
          </div>
        </div>
        `;
    }).join('');
}

// ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØµÙØ­Ù‡ Ù„Ù¾ØªØ§Ù¾â€ŒÙ‡Ø§
async function initLaptopPage() {
    const products = await fetchLaptops();
    renderProductSection("laptopsList", products);
}

initLaptopPage();
</script>
{% endblock  %}